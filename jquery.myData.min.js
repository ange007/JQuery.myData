/**
 * jquery.mydata - Small JQuery&Zepto plugin for two-ways data binding.
 * @version v0.4.3
 * @link https://github.com/ange007/JQuery.myData
 * @license MIT
 * @author Borisenko Vladimir
 */

"use strict";function _typeof(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function e(t){return typeof t}}else{_typeof=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof(e)}(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"){module.exports=e(window.Zepto||window.jQuery||window.$||require("jquery"),window,document)}else{e(window.Zepto||window.jQuery||window.$,window,document)}})(function($,window,document){"use strict";var pluginName="myData";var isJQ=!!window.jQuery;var Plugin=function e(t,n,a){this.bindings=[];this.checkTimer=undefined;this.element=$(t);this.callbacks={};this.keys={event:"data-on","event-value":"data-on-value",data:"data-bind","data-element":"data-bind-element"};if(_typeof(n)==="object"&&n.hasOwnProperty("event")&&n.hasOwnProperty("data")){this.eventTarget=n.event;this.dataTarget=n.data;if(_typeof(n["data-keys"])==="object"){this.keys={event:n["data-keys"]["event"]||this.keys["event"],"event-value":n["data-keys"]["event-value"]||this.keys["event-value"],data:n["data-keys"]["data"]||this.keys["data"],"data-element":n["data-keys"]["data-element"]||this.keys["data-element"]}}}else{this.eventTarget=n;this.dataTarget=n}if(typeof a==="function"){this.callbacks.main=a}else if(_typeof(a)==="object"){this.callbacks.main=a.main;this.callbacks.get=a.get;this.callbacks.set=a.set;this.callbacks.on=a.on}this.bind()};Plugin.prototype={bind:function e(){var i=this;this.element.find("["+this.keys["data"]+"]").each(function(e,t){var n=$(t),a=n.attr(i.keys["data"])||"";if(a===""){return}i.bindings.push({element:t,property:a,value:undefined})});this._setEventListeners();this._setCheckTimer()},unbind:function e(){this.element.off("."+pluginName,"["+this.keys["data"]+"]").off("."+pluginName,"["+this.keys["data-element"]+"]").off("."+pluginName,"["+this.keys["event"]+"]");clearInterval(this.checkTimer);this.bindings=[]},_setEventListeners:function _setEventListeners(){var context=this;var bindEvents=["change","keyup","input","paste"].map(function(e){return e+="."+pluginName});var onEvents=["click","dblclick","change","input","paste","load","unload","select","resize","scroll","submit","error","keydown","keyup","keypress","mouseover","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseleave","blur","focus","focusin","focusout"].map(function(e){return e+="."+pluginName});this.element.on(bindEvents.join(" "),"["+this.keys["data"]+"]",function(e){var t=$(e.target);var n=t.attr(context.keys["data"]);var a=undefined;for(var i in context.bindings){var s=context.bindings[i];if(s.element!==e.target||s.property!==n){continue}a=context._readElementValue(t,s.value);var r="set"+n.charAt(0).toUpperCase()+n.substr(1);if(a!==s.value){s.value=a;if(typeof context.dataTarget[r]==="function"){context.dataTarget[r].apply(context.dataTarget,[a])}else if(typeof context.dataTarget[n]==="function"){context.dataTarget[n].apply(context.dataTarget,[a])}else if(context.dataTarget.hasOwnProperty(n)){context.dataTarget[n]=a}break}}if(typeof context.callbacks.set==="function"){context.callbacks.set(t,n,a,{type:e.type})}else if(typeof context.callbacks.main==="function"){context.callbacks.main("set",t,n,a,{type:e.type})}});this.element.on(bindEvents.join(" "),"["+this.keys["data-element"]+"]",function(e){var i=$(e.target);var t=i.attr(context.keys["data-element"]);context._extractActions(i,e,t,function(e,t){var n=$(t);var a=context._readElementValue(i,n.val());context._setElementValue(n,e,a)})});this.element.on(onEvents.join(" "),"["+this.keys["event"]+"]",function(event){var element=$(this);var actionData=element.attr(context.keys["event"]);context._extractActions(element,event,actionData,function(eventType,handlerName){var handlerFunc=handlerName.match(/([a-zA-Z0-9,\.\-_\/]+)(?:\(([^)]+)\))?$/)||false;if(eventType!=event.type||!handlerFunc){return}var name=handlerFunc[1];var args=typeof handlerFunc[2]==="string"?handlerFunc[2].split(",").map(function(e){return e.trim().match(/^['"]{0,}(.*?)['"]{0,}$/)[1]||""}):[];var targetFuncExist=context.eventTarget!==undefined&&typeof context.eventTarget[name]==="function";var windowFuncExist=typeof window[name]==="function";var value=context._readElementValue(element,undefined);var callArgs=$.extend([],args);if(callArgs.length>0){callArgs.push([element,event,value])}else{callArgs=[value,[element,event,value]]}var result=undefined;if(targetFuncExist){result=context.eventTarget[name].apply(context.eventTarget,callArgs)}else{try{result=eval(name).apply(window,callArgs)}catch(e){console.warn('jQuery.myData: Could not call - "'+name+'"')}}if(typeof context.callbacks.on==="function"){context.callbacks.on(element,name,value,{type:event.type,args:args})}else if(typeof context.callbacks.main==="function"){context.callbacks.main("on",element,name,value,{type:event.type,args:args})}if(result===false){event.stopPropagation();return false}else if(result===true){event.preventDefault();return result}})})},_setCheckTimer:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:250;var o=this;this.checkTimer=setInterval(function(){for(var e in o.bindings){var t=o.bindings[e];var n=$(t.element);var a=t.property;var i=t.value;var s="";var r="get"+a.charAt(0).toUpperCase()+a.substr(1);if(typeof o.dataTarget[r]==="function"){s=o.dataTarget[r]()}else if(typeof o.dataTarget[a]==="function"){s=o.dataTarget[a]()}else if(o.dataTarget.hasOwnProperty(a)){s=o.dataTarget[a]}if(s===i){continue}t.value=s;if(n.is('input[type="checkbox"]')||n.is('input[type="radio"]')){$(n).attr("checked",s)}else if(n.is("select")||n.is("input")||n.is("textarea")){$(n).val(s)}else{$(n).html(s)}if(typeof o.callbacks.get==="function"){o.callbacks.get(n,a,s,{})}else if(typeof o.callbacks.main==="function"){o.callbacks.main("get",n,a,s,{})}}},t)},_readElementValue:function e(t,n){var a=undefined;var i=$(t).attr("value");var s=$(t).attr(this.keys["event-value"]);if(s!==undefined&&s!==""){a=s}else if(t.is('input[type="checkbox"]')||t.is('input[type="radio"]')){if(typeof n!=="boolean"&&i!==undefined){a=$(t).is(":checked")?i:false}else{a=$(t).is(":checked")}}else if(t.is("select")){if(typeof n==="number"){a=$(t).find(":selected").index()}else{a=$(t).val()}}else if(t.is("input")||t.is("textarea")){a=$(t).val()}else if(t.is("a")){a=$(t).attr("href")}else if(t.is("form")){a={};$(t[0]).serializeArray().forEach(function(e){a[e.name]=e.value})}if(a===""||a===undefined){a=i||$(t).html()}return a},_setElementValue:function e(t,n,a){if(n==="visible"||n==="hidden"){var i=n==="visible"?"hidden":"visible";if(typeof a==="boolean"&&a||typeof a==="string"&&(a==="yes"||a==="y"||a==="true")||typeof a==="integer"&&a>=1){i=n}t.css("visibility",i)}else if(n==="enabled"||n==="disabled"){if(typeof a==="boolean"&&a===true||typeof a==="string"&&(a==="yes"||a==="y")||typeof a==="integer"&&a>=1){if(n==="enabled"){t.removeAttr("disabled")}else{t.attr("disabled","disabled")}}else{if(n==="disabled"){t.removeAttr("disabled")}else{t.attr("disabled","disabled")}}}else{if(t.is("input")||t.is("textarea")){t.val(a)}else{t.text(a)}}},_extractActions:function e(t,n,a,r){var o="click";if(t.is("form")){o="submit"}else if(t.is("input, select, textarea")){o="change"}var i=[];if(typeof a!=="string"){console.error("jQuery.myData: Empty data in ["+context.keys["event"]+"].");return}else{i=a.indexOf("[")===0?(a.match(/[\[\{}](.*?)[\}\]]/)[1]||"").split(","):[a]}i.forEach(function(e,t,n){var a=e.indexOf(":")>=0?e.split(":"):[o,e];var i=a[0].trim().split(",");var s=a[1].trim();if(!s){return}i.forEach(function(e,t,n){r(e,s)})})},destroy:function e(){this.unbind()}};$.fn[pluginName]=function(a,i){var t=arguments;if(a===undefined||_typeof(a)==="object"){this.each(function(){var e=isJQ?$(this).data("_"+pluginName):$(this)[0]["_"+pluginName];var t=_typeof(a)==="object"&&a.hasOwnProperty("exlusive")?"":Math.random().toString(36).substring(7);if(!e||t!==""){var n=new Plugin(this,a,i);if(isJQ){$(this).data("_"+pluginName,n)}else{$(this)[0]["_"+pluginName]=n}}});return $(this)}else if(typeof a==="string"&&a[0]!=="_"&&a!=="init"){var n=undefined;this.each(function(){var e=isJQ?$(this).data("_"+pluginName):$(this)[0]["_"+pluginName];if(e instanceof Plugin&&typeof e[a]==="function"){n=e[a].apply(e,Array.prototype.slice.call(t,1))}});return n!==undefined?n:$(this)}}});